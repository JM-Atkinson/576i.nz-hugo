---
title: "Verify your COVID-19 vaccination pass"
date: 2021-11-13T01:26:38+13:00
draft: false
markup: html
tags: [ "interactive", "internet technologies" ]
---

<div id="major">
    <h3 id="title">Show your QR code to the camera!</h3>

    <video id="preview" autoplay="true"></video>

    <div id="detailsbox">
        <table id="detailstable">
            <tbody>
              <tr>
                <td><p>Status:</p></td>
                <td><p id="verifystatus">None yet</p></td>
              </tr>
              <tr>
                <td><p>Name:</p></td>
                <td><p id="name">N/A</p></td>
              </tr>
              <tr>
                <td><p>Date of Birth:</p></td>
                <td><p id="dob">N/A</p></td>
              </tr>
            </tbody>
        </table>
    </div>

    <p>Credit to <a href="https://pancake.nz/">pancake.nz</a> for underlying API technology.</p>

</div>

<style>
#major {
  text-align: center;
}
#detailsbox {
  border: black solid 6px;
  border-radius: 12px;
  padding: 20px;
  margin: auto;
  margin-bottom: 20px;
  display: none
}
#detailstable {
  margin: auto;
}
@media (min-width: 400px) {
    #detailsbox{
        width: 370px;
    }
}
#preview {
  margin: auto;
  margin-top: 20px;
  margin-bottom: 20px;
}
#title {
  text-align: center;
}
</style>

<script src="qr-scanner.umd.min.js"></script>
<script src="qr-scanner-worker.min.js"></script>

<script type="text/javascript"> 

    const videoElem = document.getElementById("preview");

    if (navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia({
        video: {
          facingMode: {
            exact: "environment"
          }
        }
      })
        .then(function (stream) {
          videoElem.srcObject = stream;
        })
        .catch(function (error) {
          console.log(error);
        });

      const scanner = new QrScanner(videoElem, msg => {
        let choice;
        console.log(msg);
        fetch("https://api.pancake.nz/verify", {
          body: JSON.stringify({
            "payload": msg
          }),
          headers: {
            "Content-Type": "application/json",
          },
          method: "POST"
        })
        .then(response => response.json())
        .then(data => {
          console.log(data)
          if (data.verified == true) {
            setBorderToColour("#34c759")
            document.getElementById("detailsbox").style.display = "inline-block";
            document.getElementById("verifystatus").innerHTML = "Verified!";
            document.getElementById("name").innerHTML = data.payload.givenName + " " + data.payload.familyName;
            document.getElementById("dob").innerHTML = data.payload.dob;
          } else {
            setBorderToColour("#ff0000")
            document.getElementById("detailsbox").style.display = "inline-block";
            document.getElementById("verifystatus").innerHTML = "Not verified!";
            document.getElementById("name").innerHTML = "Hidden for privacy reasons.";
            document.getElementById("dob").innerHTML = "Hidden for privacy reasons.";
          }
        })
      });
      scanner.start();
    }

    function setBorderToColour(a) {
      document.getElementById("preview").style.border = a + " solid 12px";
      document.getElementById("preview").style.borderRadius = "24px"
    }

</script>